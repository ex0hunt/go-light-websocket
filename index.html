<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>WebSocket Test</title>
</head>
<body>
    

    <h2>WebSocket Test</h2>

    <input type="text" name="msg" id="inpt">
    <br>
    <button id="cls">Close</button>

    <div id="output"></div>
    <script language="javascript" type="text/javascript">

      var wsUri = "ws://localhost:8090/";
      var output;

      function init()
      {
        output = document.getElementById("output");
        testWebSocket();
      }

      function testWebSocket()
      {
        websocket = new WebSocket(wsUri);
        websocket.onopen = function(evt) {
            onOpen(evt);
            console.log('onopen', evt);
        };
        websocket.onclose = function(evt) {
            onClose(evt);
            console.log('onclose', evt);
        };
        websocket.onmessage = function(evt) {
            onMessage(evt);
            console.log('onmessage', evt);
        };
        websocket.onerror = function(evt) {
            onError(evt);
            console.log('onerror', evt);
        };
      }

      function onOpen(evt)
      {
        writeToScreen("CONNECTED");
        doSend("WebSocket rocks");
      }

      function onClose(evt)
      {
        writeToScreen("DISCONNECTED");
      }

      function onMessage(evt)
      {
        writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
      }

      function onError(evt)
      {
        writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
      }

      function doSend(message)
      {
        writeToScreen("SENT: " + message);
        websocket.send(message);
      }

      function writeToScreen(message)
      {
        var pre = document.createElement("p");
        pre.style.wordWrap = "break-word";
        pre.innerHTML = message;
        output.insertBefore(pre, output.firstChild);
      }

      window.addEventListener("load", init, false);

      var inpt = document.getElementById('inpt');
      inpt.addEventListener("keypress", function(ev) {
          if (ev.keyCode == 13) {
              doSend(this.value)
              this.value = '';
          }
      })

      var cls = document.getElementById('cls');
      cls.addEventListener("click", function() {
          websocket.close();
      });
    </script>
</body>
</html>
