<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>WebSocket Test</title>
</head>
<body>
    

    <h2>WebSocket Test</h2>

    <input type="text" name="msg" id="inpt">
    <button id="snd">Send</button>
    <button id="cls">Close</button>

    <div id="output"></div>
    <script language="javascript" type="text/javascript">

      var wsUri = "ws://localhost:8090/";
      var output;

      function init()
      {
        output = document.getElementById("output");
        testWebSocket();
      }

      function fake(n) { 
          var x = ""; 
          for (var j = 0; j < n; j++) { 
              x += Math.round(Math.random()*9) 
          } 
          return x
      }

      function testWebSocket()
      {
        websocket = new WebSocket(wsUri);
        websocket.onopen = function(evt) {
            onOpen(evt);
            console.log('onopen', evt);
        };
        websocket.onclose = function(evt) {
            onClose(evt);
            console.log('onclose', evt);
        };
        websocket.onmessage = function(evt) {
            onMessage(evt);
            console.log('onmessage', evt);
        };
        websocket.onerror = function(evt) {
            onError(evt);
            console.log('onerror', evt);
        };
      }

      function onOpen(evt)
      {
        writeToScreen("CONNECTED");
        doSend("WebSocket rocks");
      }

      function onClose(evt)
      {
        writeToScreen("DISCONNECTED");
      }

      function onMessage(evt)
      {
        writeToScreen('<span style="color: blue;">RESPONSE: ' + cut(evt.data) + '</span>');
      }

      function onError(evt)
      {
        writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
      }

      function doSend(message)
      {
        writeToScreen("SENT: " + cut(message));
        websocket.send(message);
      }

      function cut(message) {
        if (message.length > 100) {
            return  message.substr(0,50) + '...' + message.substr(message.length - 50, 50) + ' (' + message.length + ')';
        }
        return message;
      }

      function writeToScreen(message)
      {
        var pre = document.createElement("p");
        pre.style.wordWrap = "break-word";
        pre.innerHTML = message;
        output.insertBefore(pre, output.firstChild);
      }

      window.addEventListener("load", init, false);

      var inpt = document.getElementById('inpt');
      inpt.addEventListener("keypress", function(ev) {
          if (ev.keyCode == 13) {
              doSend(this.value)
              this.value = '';
          }
      });

      var snd = document.getElementById('snd');
      snd.addEventListener("click", function(ev) {
          doSend(inpt.value);
      });

      var cls = document.getElementById('cls');
      cls.addEventListener("click", function() {
          websocket.close();
      });

    </script>
</body>
</html>
